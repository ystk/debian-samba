Backport of:

From c7acae904301cfc6a281d63f4e7d3cc6f4fff938 Mon Sep 17 00:00:00 2001
From: Stefan Metzmacher <metze@samba.org>
Date: Thu, 7 Dec 2017 13:22:22 +0100
Subject: [PATCH] docs-xml: deprecate "client schannel" and change the default
 to "yes"

This is already the default, because "require strong key = yes" is
the default.

Signed-off-by: Stefan Metzmacher <metze@samba.org>
Reviewed-by: Ralph Boehme <slow@samba.org>
---
 docs-xml/smbdotconf/security/clientschannel.xml | 11 +++++++++--
 lib/param/loadparm.c                            |  2 +-
 source3/param/loadparm.c                        |  2 +-
 3 files changed, 11 insertions(+), 4 deletions(-)

--- a/docs-xml/smbdotconf/security/clientschannel.xml
+++ b/docs-xml/smbdotconf/security/clientschannel.xml
@@ -17,6 +17,6 @@
 
     <para>This option yields precedence to the <smbconfoption name="require strong key"/> option.</para>
 </description>
-<value type="default">auto</value>
-<value type="example">yes</value>
+<value type="default">yes</value>
+<value type="example">auto</value>
 </samba:parameter>
--- a/lib/param/loadparm.c
+++ b/lib/param/loadparm.c
@@ -2670,7 +2670,7 @@ struct loadparm_context *loadparm_init(T
 
 	lpcfg_do_global_parameter(lp_ctx, "guest account", GUEST_ACCOUNT);
 
-	lpcfg_do_global_parameter(lp_ctx, "client schannel", "auto");
+	lpcfg_do_global_parameter(lp_ctx, "client schannel", "True");
 
 	lpcfg_do_global_parameter(lp_ctx, "smb encrypt", "default");
 
--- a/source3/param/loadparm.c
+++ b/source3/param/loadparm.c
@@ -647,7 +647,7 @@ static void init_globals(struct loadparm
 	Globals._client_ipc_min_protocol = PROTOCOL_DEFAULT;
 	Globals._security = SEC_AUTO;
 	Globals.encrypt_passwords = true;
-	Globals.client_schannel = Auto;
+	Globals.client_schannel = true;
 	Globals.winbind_sealed_pipes = true;
 	Globals.require_strong_key = true;
 	Globals.server_schannel = Auto;
--- a/docs/manpages/smb.conf.5
+++ b/docs/manpages/smb.conf.5
@@ -2172,10 +2172,10 @@ This option yields precedence to the
 option\&.
 .sp
 Default:
-\fI\fIclient schannel\fR\fR\fI = \fR\fIauto\fR\fI \fR
+\fI\fIclient schannel\fR\fR\fI = \fR\fIyes\fR\fI \fR
 .sp
 Example:
-\fI\fIclient schannel\fR\fR\fI = \fR\fIyes\fR\fI \fR
+\fI\fIclient schannel\fR\fR\fI = \fR\fIauto\fR\fI \fR
 .RE
 
 client signing (G)
