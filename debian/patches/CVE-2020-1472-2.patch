Backport of:

From 0341e83d40dc42fbb1f1e467626418a9e4dedf40 Mon Sep 17 00:00:00 2001
From: Stefan Metzmacher <metze@samba.org>
Date: Thu, 7 Dec 2017 13:22:22 +0100
Subject: [PATCH] docs-xml: deprecate "server schannel" and change the default
 to "yes"

No client should use the old protocol without DCERPC level integrity/privacy,
but Maybe there're some lagacy OEM file servers, which require this.

Signed-off-by: Stefan Metzmacher <metze@samba.org>
Reviewed-by: Ralph Boehme <slow@samba.org>
---
 docs-xml/smbdotconf/security/serverschannel.xml | 13 +++++++++++--
 lib/param/loadparm.c                            |  2 +-
 source3/param/loadparm.c                        |  2 +-
 3 files changed, 13 insertions(+), 4 deletions(-)

--- a/docs-xml/smbdotconf/security/serverschannel.xml
+++ b/docs-xml/smbdotconf/security/serverschannel.xml
@@ -17,6 +17,6 @@
 	</para>
 </description>
 
-<value type="default">auto</value>
-<value type="example">yes</value>
+<value type="default">yes</value>
+<value type="example">auto</value>
 </samba:parameter>
--- a/lib/param/loadparm.c
+++ b/lib/param/loadparm.c
@@ -2616,7 +2616,7 @@ struct loadparm_context *loadparm_init(T
 
 	lpcfg_do_global_parameter(lp_ctx, "winbind nss info", "template");
 
-	lpcfg_do_global_parameter(lp_ctx, "server schannel", "Auto");
+	lpcfg_do_global_parameter(lp_ctx, "server schannel", "True");
 
 	lpcfg_do_global_parameter(lp_ctx, "short preserve case", "True");
 
--- a/source3/param/loadparm.c
+++ b/source3/param/loadparm.c
@@ -650,7 +650,7 @@ static void init_globals(struct loadparm
 	Globals.client_schannel = true;
 	Globals.winbind_sealed_pipes = true;
 	Globals.require_strong_key = true;
-	Globals.server_schannel = Auto;
+	Globals.server_schannel = true;
 	Globals.read_raw = true;
 	Globals.write_raw = true;
 	Globals.null_passwords = false;
--- a/docs/manpages/smb.conf.5
+++ b/docs/manpages/smb.conf.5
@@ -9702,10 +9702,10 @@ WinXP_SignOrSeal\&.reg
 registry patch found in the docs/registry subdirectory of the Samba distribution tarball\&.
 .sp
 Default:
-\fI\fIserver schannel\fR\fR\fI = \fR\fIauto\fR\fI \fR
+\fI\fIserver schannel\fR\fR\fI = \fR\fIyes\fR\fI \fR
 .sp
 Example:
-\fI\fIserver schannel\fR\fR\fI = \fR\fIyes\fR\fI \fR
+\fI\fIserver schannel\fR\fR\fI = \fR\fIauto\fR\fI \fR
 .RE
 
 server services (G)
